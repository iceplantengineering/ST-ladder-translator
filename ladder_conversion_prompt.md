# 構造化言語→三菱PLCラダープログラム変換アプリ開発

## プロジェクト概要
自動倉庫の在庫管理システムを構造化言語（ST/IL）から三菱電機PLCのラダープログラムに自動変換するWebアプリケーションを開発してください。

## 要件定義

### 機能要件
1. **ファイル入力機能**
   - 構造化言語ソースコードのアップロード（.st, .il, .txt対応）
   - ドラッグ&ドロップ、複数ファイル一括処理

2. **構文解析機能**
   - IF-THEN-ELSE、FOR/WHILE、CASE文の解析
   - 変数宣言、データタイプ認識
   - 演算子、関数呼び出しの識別

3. **変換エンジン**
   - 構造化言語 → ラダーロジック変換ルール
   - 三菱PLCデバイス（X,Y,M,D,T,C）への自動割り当て
   - 最適化機能（回路簡略化、デバイス使用量削減）

4. **ラダー図生成・表示**
   - リアルタイムプレビュー機能
   - ズーム、パン操作
   - 回路ブロック単位での表示切替

5. **出力機能**
   - GX Works形式(.gxw)でのエクスポート
   - CSV形式デバイスリスト出力
   - 変換レポート生成（エラー、警告、統計情報）

### 非機能要件
- レスポンス時間：中規模ファイル（1000行）を5秒以内で処理
- 可用性：99%稼働率
- 拡張性：他メーカーPLC（オムロン、キーエンス）への対応余地

## 技術仕様

### フロントエンド
**技術スタック:** React 18 + TypeScript + Vite
**UI実装戦略:**
```typescript
// AI生成でそのまま使用可能（30分）
- FileUploadComponent: ドラッグ&ドロップ ✅
- ConversionControlPanel: 設定フォーム ✅  
- ResultPanel: エラー・ログ表示 ✅

// AI生成+軽微調整（1時間）
- CodeEditorComponent: Monaco統合 🔧

// AI生成+専門調整（2時間）  
- LadderViewComponent: Canvas描画 🎯
  └ 基本フレーム：AI生成
  └ ラダー記号：ドメイン知識で調整
```

**調整レベル別対応:**
- **Level 1（そのまま）**: 管理機能、フォーム
- **Level 2（CSS調整）**: レイアウト、色調整
- **Level 3（ロジック調整）**: ドメイン固有の動作

**ラダー図描画仕様:**
- Canvas API使用、60FPS描画
- 標準的なラダー記号（接点、コイル、ファンクション）
- 日本語コメント対応

### バックエンド
**技術スタック:** Python 3.11 + FastAPI + SQLAlchemy
**API設計:**
```python
POST /api/convert
- Request: {"source_code": str, "plc_type": "mitsubishi", "options": {}}
- Response: {"ladder_data": {}, "device_map": {}, "errors": [], "warnings": []}

GET /api/conversion-history
POST /api/save-conversion
GET /api/templates  # 変換テンプレート管理
```

**変換アルゴリズム:**
1. 字句解析 → 構文解析 → AST生成
2. 制御フロー分析（分岐、ループ検出）
3. ラダーパターンマッチング
4. デバイス割り当て最適化
5. 三菱PLCコード生成

### データベース設計
**PostgreSQL テーブル:**
```sql
-- 変換履歴
conversions (id, user_id, source_file, result_data, created_at)
-- 変換ルール管理  
conversion_rules (id, pattern, ladder_template, priority)
-- デバイス管理
device_assignments (conversion_id, device_type, address, description)
```

## AI駆動開発手順

### Phase 1: プロトタイプ生成（1時間）
**AI使用:**
- ChatGPT/Claude: フロントエンド React コンポーネント生成
- GitHub Copilot: バックエンド FastAPI スキーフォールド
- Cursor/Windsurf: 全体アーキテクチャの自動生成
**成果物:** 動作するMVP

### Phase 2: コア機能実装（2-3時間）
**AI使用:**
1. **構造化言語パーサー**: AIにANTLRグラマー生成依頼→即座にパーサー完成
2. **変換エンジン**: パターンマッチングロジックをAIが生成
3. **ラダー図描画**: Canvas描画コードをAIが実装
4. **統合テスト**: AIがテストケース自動生成

### Phase 3: 品質向上・カスタマイズ（1-2時間）
**人間の作業:**
1. ドメイン知識の注入（三菱PLC固有仕様）
2. 変換精度の検証・調整
3. UI/UXの最終調整
4. 本番環境デプロイ設定

## 技術的考慮点

### セキュリティ
- ファイルアップロード時のウイルススキャン
- 入力値検証、SQLインジェクション対策
- CORS設定、認証機能（将来拡張）

### パフォーマンス
- 大容量ファイル処理時の非同期処理
- ラダー図描画の仮想化（表示範囲のみ描画）
- Redis使用の変換結果キャッシュ

### 保守性
- 変換ルールの外部設定ファイル化
- ログ機能、エラートラッキング
- 自動テスト、CI/CD構築

## 成果物
1. Webアプリケーション（フロント+バック）
2. 変換精度レポート
3. ユーザーマニュアル、技術仕様書
4. デプロイメント手順書

## AI駆動開発期間・体制
- **期間:** **4-6時間** （従来の140倍高速）
- **要員:** エンジニア1名 + AI開発支援ツール
- **マイルストーン:** 1時間毎の動作確認

## AI活用戦略
**使用するAIツール:**
1. **Cursor/Windsurf**: 全体アーキテクチャ生成
2. **GitHub Copilot**: リアルタイムコード補完
3. **ChatGPT-4/Claude**: 複雑なロジック設計
4. **v0/Bolt**: UI コンポーネント即座生成
5. **Replit**: 環境構築自動化

**開発フロー:**
```
AIにプロンプト → コード生成 → 動作確認 → 調整依頼 → 完成
     ↓
従来2週間の作業が1時間で完了
```

このプロンプトを使用して、AI駆動で高速開発を進めてください。特に最初の1時間でMVPを完成させ、残り時間で精度とUXを磨き上げることに集中してください。